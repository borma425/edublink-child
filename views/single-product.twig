<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ product_title }} - {{ site.name }}</title>
    <link rel="stylesheet" href="{{ theme_uri }}/assets/global/styles.css" />
    <link rel="stylesheet" href="{{ theme_uri }}/assets/single-product/style.css" />
  </head>
  <body class="learnsimply-homepage-body">
    
    {% include 'components/header.twig' %}

    <!-- ===== START: Main Content ===== -->
    <main class="course-main-content">
      <div class="container">
        <div class="course-page">
        <!-- Product details card (left side) -->
          <div class="course-details-card">
            <!-- Top discount ribbon -->
            {% if discount_percent > 0 %}
            <div class="discount-banner">
              <p class="discount-banner-text">
                خصم {{ discount_percent }}% لمدة 3 أيام فقط — العرض سينتهي قريبًا!
              </p>
            </div>
            {% endif %}

            <!-- Stats box -->
            <div class="stats-box">
              {% if book_pages %}
              <div class="stat-item">
                <svg class="stat-icon" fill="none" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10" stroke="#999EB2" stroke-width="1.5" />
                  <path d="M12 8V12L14.5 14.5" stroke="#999EB2" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
                </svg>
                <p class="stat-text">{{ book_pages }} صفحة</p>
              </div>

              <div class="stat-divider"></div>
              {% endif %}

              {% if book_available_count %}
              <div class="stat-item">
                <img class="stat-icon" src="{{ theme_uri }}/assets/img/Inbox Line.png" alt="محتوي" />
                <p class="stat-text">{{ book_available_count }} متوفر</p>
              </div>
              {% endif %}
            </div>

            <!-- Details box -->
            <div class="details-box">
              <!-- Category -->
              {% if categories|length > 0 %}
              <div class="detail-row">
                <svg class="detail-icon" fill="none" viewBox="0 0 24 24">
                  <path d="M18 10H13" stroke="#999EB2" stroke-linecap="round" stroke-width="1.5" />
                  <path d="M10 3H16.5C16.9644 3 17.1966 3 17.3916 3.02567C18.7378 3.2029 19.7971 4.26222 19.9743 5.60842C20 5.80337 20 6.03558 20 6.5" stroke="#999EB2" stroke-width="1.5" />
                  <path d="M2 6.94975C2 6.06722 2 5.62595 2.06935 5.25839C2.37464 3.64031 3.64031 2.37464 5.25839 2.06935C5.62595 2 6.06722 2 6.94975 2C7.33642 2 7.52976 2 7.71557 2.01738C8.51665 2.09229 9.27652 2.40704 9.89594 2.92051C10.0396 3.03961 10.1763 3.17633 10.4497 3.44975L11 4C11.8158 4.81578 12.2237 5.22367 12.7121 5.49543C12.9804 5.64471 13.2651 5.7626 13.5604 5.84678C14.0979 6 14.6747 6 15.8284 6H16.2021C18.8345 6 20.1506 6 21.0062 6.76946C21.0849 6.84024 21.1598 6.91514 21.2305 6.99383C22 7.84935 22 9.16554 22 11.7979V14C22 17.7712 22 19.6569 20.8284 20.8284C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.8284C2 19.6569 2 17.7712 2 14V6.94975Z" stroke="#999EB2" stroke-width="1.5" />
                </svg>
                <div class="detail-content">
                  <p class="detail-label">الفئه</p>
                  <div class="detail-value">{{ categories[0].name }}</div>
                </div>
              </div>
              {% endif %}

              <!-- Author / Instructor -->
              {% if product_author %}
              <div class="detail-row">
                <svg class="detail-icon" fill="none" viewBox="0 0 24 24">
                  <path d="M4.75 8.75C6.95914 8.75 8.75 6.95914 8.75 4.75C8.75 2.54086 6.95914 0.75 4.75 0.75C2.54086 0.75 0.75 2.54086 0.75 4.75C0.75 6.95914 2.54086 8.75 4.75 8.75Z" stroke="#999EB2" stroke-width="1.5" transform="translate(7.25, 2)" />
                  <path d="M7.75 8.75C11.616 8.75 14.75 6.95914 14.75 4.75C14.75 2.54086 11.616 0.75 7.75 0.75C3.88401 0.75 0.75 2.54086 0.75 4.75C0.75 6.95914 3.88401 8.75 7.75 8.75Z" stroke="#999EB2" stroke-width="1.5" transform="translate(4.25, 13)" />
                </svg>
                <div class="detail-content">
                  <p class="detail-label">المؤلف</p>
                  <div class="detail-value">{{ product_author.name }}</div>
                </div>
              </div>
              {% endif %}

              <!-- Last update -->
              {% if product_updated %}
              <div class="detail-row">
                <svg class="detail-icon" fill="none" viewBox="0 0 24 24">
                  <path d="M0.750001 8.75C0.750001 4.97876 0.750001 3.09315 1.92157 1.92157C3.09315 0.750001 4.97876 0.750001 8.75 0.750001H12.75C16.5212 0.750001 18.4069 0.750001 19.5784 1.92157C20.75 3.09315 20.75 4.97876 20.75 8.75V10.75C20.75 14.5212 20.75 16.4069 19.5784 17.5784C18.4069 18.75 16.5212 18.75 12.75 18.75H8.75C4.97876 18.75 3.09315 18.75 1.92157 17.5784C0.750001 16.4069 0.750001 14.5212 0.750001 10.75V8.75Z" stroke="#999EB2" stroke-width="1.5" transform="translate(1.25, 2.25)" />
                  <path d="M4.75 2.75H2.75M2.75 2.75H0.75M2.75 2.75V0.75M2.75 2.75V4.75" stroke="#999EB2" stroke-linecap="round" stroke-width="1.5" transform="translate(14, 14)" />
                  <path d="M0.75 2.25V0.75" stroke="#999EB2" stroke-linecap="round" stroke-width="1.5" transform="translate(16.25, 2.5)" />
                  <path d="M0.75 2.25V0.75" stroke="#999EB2" stroke-linecap="round" stroke-width="1.5" transform="translate(7, 2.5)" />
                  <path d="M0.75 0.75H19.75" stroke="#999EB2" stroke-linecap="round" stroke-width="1.5" transform="translate(2.25, 9)" />
                </svg>
                <div class="detail-content">
                  <p class="detail-label">اخر تحديث</p>
                  <div class="detail-value">{{ product_updated }}</div>
                </div>
              </div>
              {% endif %}
            </div>

            <!-- Price box -->
            <div class="price-box">
              <div class="price-section">
                {% if discount_percent > 0 %}
                <div class="discount-badge">خصم {{ discount_percent }}%</div>
                {% endif %}
                {% if regular_price_formatted %}
                <p class="old-price">{{ regular_price_formatted }} جنيه مصري</p>
                {% endif %}
                {% if sale_price_formatted %}
                <p class="current-price">{{ sale_price_formatted }} جنية مصري</p>
                {% elseif price_formatted %}
                <p class="current-price">{{ price_formatted }} جنية مصري</p>
                {% else %}
                <p class="current-price">مجاني</p>
                {% endif %}
              </div>
            </div>

            <!-- Action buttons -->
            <div class="action-buttons">
              <button class="share-button" onclick="shareProduct()">
                <svg width="24" height="24" fill="none" viewBox="0 0 24 24">
                  <path d="M14.6644 5.47875L18.6367 9.00968C20.2053 10.404 20.9896 11.1012 20.9896 11.9993C20.9896 12.8975 20.2053 13.5946 18.6367 14.989L14.6644 18.5199C13.9484 19.1563 13.5903 19.4746 13.2952 19.342C13 19.2095 13 18.7305 13 17.7725V15.4279C9.4 15.4279 5.5 17.1422 4 19.9993C4 10.8565 9.33333 8.57075 13 8.57075V6.22616C13 5.26817 13 4.78917 13.2952 4.65662C13.5903 4.52407 13.9484 4.8423 14.6644 5.47875Z" stroke="#999EB2" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" />
                </svg>
              </button>
              {% if is_in_stock %}
                <a href="{{ site.url }}/?add-to-cart={{ product_id }}" class="buy-button add-to-cart-button" data-product-id="{{ product_id }}">اشتر الآن</a>
              {% else %}
                <button class="buy-button" disabled>غير متوفر</button>
              {% endif %}
            </div>

            <!-- Features list -->
            {% if first_five_features|length > 0 %}
            <div class="features-box">
              <div class="features-list">
                {% for feature in first_five_features %}
                  <div class="feature-item">
                    <svg class="feature-icon" fill="none" viewBox="0 0 24 24">
                      <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="#4077F3" />
                      <path d="M10.58 15.58C10.38 15.58 10.19 15.5 10.05 15.36L7.22 12.53C6.93 12.24 6.93 11.76 7.22 11.47C7.51 11.18 7.99 11.18 8.28 11.47L10.58 13.77L15.72 8.63C16.01 8.34 16.49 8.34 16.78 8.63C17.07 8.92 17.07 9.4 16.78 9.69L11.11 15.36C10.97 15.5 10.78 15.58 10.58 15.58Z" fill="white" />
                    </svg>
                    <p class="feature-text">{{ feature }}</p>
                  </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}
          </div>

          <!-- Right-hand section -->
          <div class="course-info-section">
            <!-- Main product image -->
            <div class="main-product-image">
              <img src="{{ product_image }}" alt="{{ product_title }}" />
            </div>

            <!-- Images gallery -->
            {% if gallery_images|length > 0 %}
            <div class="gallery-images">
              {% for gallery_image in gallery_images|slice(0, 5) %}
              <div class="gallery-image-item">
                <img src="{{ gallery_image }}" alt="Gallery {{ loop.index }}" />
              </div>
              {% endfor %}
            </div>
            {% endif %}

            <!-- Top badges -->
            <div class="product-badges">
              {% if students_count > 0 %}
              <div class="students-badge">
                <span class="badge-text">عدد الطلاب المشتركين</span>
                <div class="students-avatars">
                  <img class="avatar" src="{{ theme_uri }}/assets/img/ellipse1.png" alt="Student" />
                  <img class="avatar" src="{{ theme_uri }}/assets/img/ellipse2.png" alt="Student" />
                  <img class="avatar" src="{{ theme_uri }}/assets/img/ellipse3.png" alt="Student" />
                  <div class="avatar-badge">{{ students_count }}+</div>
                </div>
              </div>
              {% endif %}
              <div class="product-type-badge">
                منتج
              </div>
            </div>

            <!-- Product title -->
            <div class="course-title">
              {{ product_title }}
            </div>

            <!-- Product description -->
            <div class="course-description">
              {{ product_excerpt ?: product_content|striptags|slice(0, 200) ~ '...' }}
            </div>
          </div>
        </div>

        <!-- Add new review form for the product -->
        {% if reviews_form %}
        <div class="add-review-section">
          <div class="card-content">
            <div class="section-header">
              <div class="section-icon-box">
                <svg width="33" height="33" fill="none" viewBox="0 0 33 33">
                  <path clip-rule="evenodd" d="M16.5 30.25C10.0182 30.25 6.77728 30.25 4.76365 28.2363C2.75 26.2228 2.75 22.9818 2.75 16.5C2.75 10.0182 2.75 6.77728 4.76365 4.76365C6.77728 2.75 10.0182 2.75 16.5 2.75C22.9818 2.75 26.2228 2.75 28.2363 4.76365C30.25 6.77728 30.25 10.0182 30.25 16.5C30.25 22.9818 30.25 26.2228 28.2363 28.2363C26.2228 30.25 22.9818 30.25 16.5 30.25ZM16.5 24.4062C17.0695 24.4062 17.5312 23.9445 17.5312 23.375V15.125C17.5312 14.5555 17.0695 14.0938 16.5 14.0938C15.9305 14.0938 15.4688 14.5555 15.4688 15.125V23.375C15.4688 23.9445 15.9305 24.4062 16.5 24.4062ZM16.5 9.625C17.2594 9.625 17.875 10.2406 17.875 11C17.875 11.7594 17.2594 12.375 16.5 12.375C15.7406 12.375 15.125 11.7594 15.125 11C15.125 10.2406 15.7406 9.625 16.5 9.625Z" fill="white" fill-rule="evenodd" />
                </svg>
              </div>
              <h2 class="section-title">أضف تقييمك للمنتج</h2>
            </div>

            {% if is_user_logged_in %}
            <div class="add-review-form">
              {{ reviews_form|raw }}
            </div>
            {% else %}
            <div class="add-review-form">
              <p class="login-required-message">
                يجب تسجيل الدخول أولًا قبل إضافة تقييم.
              </p>
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}

       <!-- Reviews card for the product (same design as course/bundle pages) -->
        {% if course_reviews|length > 0 %}
        <div class="reviews-section">
          <!-- Ratings Overview -->
          <div class="ratings-overview">
            <div class="ratings-overview-content">
              <!-- Header -->
              <div class="ratings-header">
                <div class="stars-icon">
                  <svg width="33" height="33" fill="none" viewBox="0 0 33 33">
                    <path d="M26.125 4.46875C26.6945 4.46875 27.1562 4.93046 27.1562 5.5V5.84375H27.5C28.0695 5.84375 28.5312 6.30546 28.5312 6.875C28.5312 7.44454 28.0695 7.90625 27.5 7.90625H27.1562V8.25C27.1562 8.81954 26.6945 9.28125 26.125 9.28125C25.5555 9.28125 25.0938 8.81954 25.0938 8.25V7.90625H24.75C24.1805 7.90625 23.7188 7.44454 23.7188 6.875C23.7188 6.30546 24.1805 5.84375 24.75 5.84375H25.0938V5.5C25.0938 4.93046 25.5555 4.46875 26.125 4.46875Z" fill="white" />
                    <path d="M6.69284 3.4383C6.73408 3.29285 6.99226 3.29197 7.03447 3.43714C7.22725 4.10004 7.58472 5.0799 8.12526 5.61681C8.66581 6.15372 9.64805 6.50455 10.3122 6.69284C10.4577 6.73408 10.4586 6.99226 10.3134 7.03447C9.65049 7.22725 8.67064 7.58472 8.13374 8.12526C7.59683 8.66581 7.24599 9.64805 7.0577 10.3122C7.01646 10.4577 6.75828 10.4586 6.71606 10.3134C6.52329 9.65049 6.16583 8.67064 5.62528 8.13374C5.08472 7.59683 4.10249 7.24599 3.4383 7.0577C3.29285 7.01646 3.29197 6.75828 3.43714 6.71606C4.10004 6.52329 5.0799 6.16583 5.61681 5.62528C6.15372 5.08472 6.50455 4.10249 6.69284 3.4383Z" fill="white" />
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.8603 10.8585C15.3406 8.20285 16.0809 6.875 17.1875 6.875C18.2941 6.875 19.0344 8.20285 20.5147 10.8585L20.8978 11.5456C21.3184 12.3003 21.5288 12.6776 21.8567 12.9266C22.1847 13.1755 22.5932 13.268 23.4101 13.4528L24.1538 13.6211C27.0285 14.2715 28.4659 14.5967 28.8079 15.6964C29.1499 16.796 28.1699 17.942 26.2101 20.2337L25.7031 20.8266C25.1461 21.4779 24.8677 21.8035 24.7424 22.2064C24.6172 22.6091 24.6593 23.0436 24.7435 23.9125L24.8201 24.7035C25.1164 27.7612 25.2645 29.2901 24.3693 29.9698C23.474 30.6494 22.1282 30.0297 19.4366 28.7904L18.7402 28.4698C17.9754 28.1176 17.5929 27.9415 17.1875 27.9415C16.7822 27.9415 16.3996 28.1176 15.6349 28.4698L14.9384 28.7904C12.2468 30.0297 10.901 30.6494 10.0057 29.9698C9.11041 29.2901 9.25856 27.7612 9.55486 24.7035L9.63152 23.9125C9.71571 23.0436 9.75781 22.6091 9.63253 22.2064C9.50727 21.8035 9.22881 21.4779 8.67189 20.8266L8.16486 20.2337C6.20504 17.942 5.22514 16.796 5.56711 15.6964C5.90908 14.5967 7.34646 14.2715 10.2212 13.6211L10.9649 13.4528C11.7819 13.268 12.1903 13.1755 12.5183 12.9266C12.8462 12.6776 13.0566 12.3003 13.4773 11.5456L13.8603 10.8585Z" fill="white" />
                  </svg>
                </div>
                <p class="ratings-title">تقييمات مشترين المنتج</p>
              </div>

              <!-- Ratings Content -->
              <div class="ratings-content">
                <div class="ratings-list-container">
                  <div class="ratings-list">
                    <!-- Rating rows will be generated dynamically -->
                    {% for i in 5..1 %}
                      {% set rating_count_local = 0 %}
                      {% for review in course_reviews %}
                        {% if review.rating == i %}
                          {% set rating_count_local = rating_count_local + 1 %}
                        {% endif %}
                      {% endfor %}
                      {% set percentage = rating_count_local > 0 ? (rating_count_local / course_reviews|length * 100)|round : 0 %}
                      <div class="rating-row">
                        <div class="stars-group">
                          {% for j in 1..5 %}
                            <svg class="star-icon {% if j <= i %}filled{% else %}empty{% endif %}" viewBox="0 0 24 24">
                              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                            </svg>
                          {% endfor %}
                        </div>
                        <div class="progress-container">
                          <div class="progress-bg"></div>
                          <div class="progress-fill" style="right: {{ 100 - percentage }}%"></div>
                        </div>
                        <p class="percentage">{{ percentage }}%</p>
                      </div>
                    {% endfor %}
                  </div>
                </div>
                <div class="rating-summary">
                  <div class="rating-summary-content">
                    <p class="summary-title">التقييم</p>
                    <div class="summary-stars">
                      {% for i in 1..5 %}
                        <svg class="star-icon {% if i <= rating_avg|round %}filled{% else %}empty{% endif %}" viewBox="0 0 24 24">
                          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                        </svg>
                      {% endfor %}
                    </div>
                    <p class="summary-rating">{{ rating_avg }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Review Cards -->
          <div class="review-cards">
            {% for review in course_reviews %}
            <div class="review-card">
              <div class="review-card-content">
                <div class="review-header">
                  <div class="review-header-inner">
                    <div class="review-info-group">
                      <div class="review-stars">
                        {% for i in 1..5 %}
                          <svg class="star-icon {% if i <= review.rating %}filled{% else %}empty{% endif %}" viewBox="0 0 16 16">
                            <path d="M8 1.33l2.36 4.78L15.5 7.5l-3.5 3.41.83 4.83L8 13.68l-4.83 2.54.83-4.83L.5 7.5l5.14-.39L8 1.33z" />
                          </svg>
                        {% endfor %}
                      </div>
                      <div class="user-details">
                        <p class="user-name">{{ review.author }}</p>
                        <p class="review-date">{{ review.date|date('d/m/Y') }}</p>
                      </div>
                    </div>
                  </div>
                  <div class="avatar">
                    <img src="{{ review.avatar ?: theme_uri ~ '/assets/img/ellipse1.png' }}" alt="User Avatar" />
                  </div>
                </div>
                <div class="review-text">
                  <p>{{ review.content|slice(0, 200) }}{% if review.content|length > 200 %}... <span class="show-more">عرض المزيد</span>{% endif %}</p>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

      </div>
    </main>
    <!-- ===== END: Main Content ===== -->

    {% include 'components/footer.twig' %}

    <!-- Floating Scroll to Top Button -->
    <button class="learnsimply-scroll-to-top" aria-label="الرجوع للأعلى">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M12 19V5M5 12l7-7 7 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>

    <script src="{{ theme_uri }}/assets/global/script.js"></script>
    <script src="{{ theme_uri }}/assets/single-product/script.js"></script>
  </body>
</html>

